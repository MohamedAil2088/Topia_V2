const axios = require('axios');

const API_URL = 'http://localhost:5000/api';
let adminToken = '';

const loginAdmin = async () => {
    try {
        // افترض أننا نستخدم نفس المستخدم الذي رقيناه لأدمن
        // سأقوم بتسجيل دخول وهمي للحصول على توكن جديد (أو استخدم القديم لو ما زال صالحاً، لكن الأفضل جديد)
        // ملاحظة: هذا يتطلب معرفة إيميل وباسورد المستخدم الموجود.
        // سأفترض وجود مستخدم قمنا بإنشائه في test-auth.js
        // بما أن الإيميل كان عشوائي، سأبحث عن طريقة آخرى أو أقوم بإنشاء مستخدم جديد تماماً هنا كأدمن.

        // الأفضل: إنشاء أدمن جديد بالكامل في هذا السكريبت
        const adminUser = {
            name: 'Admin User',
            email: `admin${Date.now()}@example.com`,
            password: 'password123',
            phone: '0000000000'
        };

        // تسجيل
        const regRes = await axios.post(`${API_URL}/auth/register`, adminUser);
        adminToken = regRes.data.token;
        console.log('✅ Admin Registered & Logged in');

        // ترقية هذا المستخدم لأدمن (لأن التسجيل الافتراضي user)
        // لكن wait، السكربت ده client side، ما يقدرش يغير الداتابيز مباشرة.
        // هحتاج أشغل make-admin.js يدوياً الأول على أول يوزر.
        // أو... سأستخدم التوكن اللي هاخده وأجرب بيه، واتوقع فشل (401)، وبعدين أرقيه وأجرب تاني.

        // الحل العملي للآن: سأعتمد على أني شغلت make-admin.js على المستخدم الموجود مسبقاً.
        // لكن بما أني لا أعرف إيميله (كان dynamic)، ساصعب الأمر.

        // الحل: سأقوم بإنشاء مستخدم جديد هنا، ثم سأطلب منك تشغيل السيرفر ومن ثم تشغيل make-admin.js يدوياً؟ لا.

        // سأقوم بتعديل make-admin.js ليقبل إيميل، أو يغير *كل* المستخدمين لأدمن مؤقتاً للتسهيل.
        // لا، سأقوم بإنشاء مستخدم هنا، وأطبع إيميله، ثم سأستخدم script آخر لترقيته؟ معقد.

        // سأقوم بتضمين كود make-admin داخل الـ flow هنا؟ لا يمكن لأن هذا client script لا يتصل بالـ DB مباشرة (أو يمكنه لو استخدمت mongoose هنا).
        // نعم، سأستخدم mongoose هنا مباشرة لترقية المستخدم!
    } catch (error) {
        console.error('Login Error:', error.message);
    }
};

// ... سأكتب السكريبت المتكامل الذي يتصل بالـ DB للترقية ثم يختبر الـ API

const mongoose = require('mongoose');
const User = require('./src/models/User'); // سنحتاج لاستيراد المودل
// لاحظ: استيراد المودل قد يسبب مشاكل لو المسارات مش مظبوطة أو فيه اعتماديات.
// الأبسط: سأفصل عملية الترقية في ملف منفصل (make-admin.js) وأشغله مرة واحدة.
